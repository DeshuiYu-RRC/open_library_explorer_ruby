<!-- Breadcrumb Navigation -->
<div class="row mb-4">
  <div class="col-md-12">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to "Home", root_path %></li>
        <li class="breadcrumb-item"><%= link_to "Authors", authors_path %></li>
        <li class="breadcrumb-item active"><%= @author.name %></li>
      </ol>
    </nav>
  </div>
</div>

<!-- Author Profile -->
<div class="row">
  <!-- Author Photo and Info -->
  <div class="col-md-4">
    <div class="card">
      <div class="card-body text-center">
        <% if @author.photo_url.present? %>
          <%= image_tag @author.photo_url,
                        alt: @author.name,
                        class: "img-fluid rounded mb-3",
                        style: "max-width: 250px; height: auto;" %>
        <% else %>
          <div class="bg-secondary text-white d-flex align-items-center justify-content-center rounded mx-auto mb-3"
               style="width: 250px; height: 300px; font-size: 80px;">
            <%= @author.name[0].upcase %>
          </div>
        <% end %>

        <h2><%= @author.name %></h2>

        <!-- Birth and Death Dates -->
        <% if @author.birth_date.present? || @author.death_date.present? %>
          <p class="text-muted">
            <% if @author.birth_date.present? %>
              Born: <%= @author.birth_date %>
            <% end %>
            <% if @author.death_date.present? %>
              <br>Died: <%= @author.death_date %>
            <% end %>
          </p>
        <% end %>

        <!-- Statistics -->
        <div class="mt-3">
          <div class="row text-center">
            <div class="col-6">
              <h3><%= @author.books.count %></h3>
              <small class="text-muted">Books</small>
            </div>
            <div class="col-6">
              <h3><%= @author.books.joins(:subjects).distinct.count('subjects.id') %></h3>
              <small class="text-muted">Subjects</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Author Details and Books -->
  <div class="col-md-8">
    <!-- Biography -->
    <div class="card mb-4">
      <div class="card-body">
        <h3 class="card-title">Biography</h3>
        <% if @author.bio.present? %>
          <p class="card-text"><%= simple_format(@author.bio) %></p>
        <% else %>
          <p class="card-text text-muted">No biography available for this author.</p>
        <% end %>
      </div>
    </div>

    <!-- Books by This Author (Feature 3.4 - Hierarchical Navigation) -->
    <h3 class="mb-3">Books by <%= @author.name %></h3>

    <% if @books.any? %>
      <div class="row">
        <% @books.each do |book| %>
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="row g-0">
                <div class="col-4">
                  <%= link_to book_path(book) do %>
                    <%= image_tag book.cover_image_url('M'),
                                  alt: book.title,
                                  class: "img-fluid rounded-start",
                                  style: "height: 200px; width: 100%; object-fit: cover;" %>
                  <% end %>
                </div>
                <div class="col-8">
                  <div class="card-body">
                    <h5 class="card-title">
                      <%= link_to book.title.truncate(50), book_path(book), class: "text-decoration-none" %>
                    </h5>

                    <% if book.first_publish_year.present? %>
                      <p class="card-text">
                        <small class="text-muted">
                          Published: <%= book.first_publish_year %>
                        </small>
                      </p>
                    <% end %>

                    <!-- Subjects -->
                    <% if book.subjects.any? %>
                      <div class="mb-2">
                        <% book.subjects.limit(3).each do |subject| %>
                          <%= link_to subject.name, subject_path(subject),
                                      class: "badge bg-secondary text-decoration-none me-1" %>
                        <% end %>
                      </div>
                    <% end %>

                    <!-- Rating -->
                    <div class="star-rating">
                      <%= '⭐' * book.average_rating.round %>
                      <small class="text-muted">
                        (<%= book.reviews.count %>)
                      </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Pagination for Books -->
      <div class="row mt-4">
        <div class="col-md-12 text-center">
          <%= paginate @books %>
        </div>
      </div>
    <% else %>
      <div class="alert alert-info">
        <p class="mb-0">No books found for this author.</p>
      </div>
    <% end %>
  </div>
</div>

<!-- Back Button -->
<div class="row mt-4">
  <div class="col-md-12">
    <%= link_to "← Back to Authors", authors_path, class: "btn btn-secondary" %>
  </div>
</div>